{% extends 'base.html' %}


{% block title %}Q&A{% endblock %}
                  

{% block nav %}
                  <li class="nav-item">
                    <a class="nav-link w3-bar-item w3-button" href="/">Home</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active w3-bar-item w3-button" href="/learn" aria-current="page">Learn Now</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link w3-bar-item w3-button" href="/play">Play Now</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link w3-bar-item w3-button" href="/Information">Information</a>
                  </li>
{% endblock %}



{% block body %}
<div class="container-fluid">
  <div style="margin-top: 100px;">
      <h1>Q&A</h1>
  </div>

  <div class="row">
    <div class="col-7">

      <div class="w3-center" style = "display: flex; flex-direction: column">

          <form method="POST" action="{{ url_for('learn.pdf_page') }}">
              <label for="page">Page:</label>
              <input type="number" id="page" name="page" min="1" max="{{ max_length }}" value="{{page}}">
              <input type="submit" value="Go">
          </form>
          <br>
          <pre class = "extracted-text">{{ texts[page-1] }}</pre>

      </div>
      
      <div class="w3-display-bottomleft" style = "background-color: white; margin-bottom: 2%; margin-left: 2%; position: fixed">
          <button class="btn" style=" padding: 10px 32px; text-align: center;font-size: 20px;"><a href="/play"><i class="fa fa-gamepad"></i> Relax now</a></button>
      </div>

    </div>
    <div class="col-5">
      <div class="card border-primary mt-3" style="height: 600px">
        <div class="card-header">
          Ask Question
        </div>
        <div class="card-body" id="chatBox" style="overflow-y: scroll;">
        </div>
      </div>
        
      <form class="row" style="margin-top: 0;" onsubmit="submitHandle">
          <div class="col-12">
            <input id="questionInput" style="width: 100%" class="form-control form-control-lg border-primary" type="text" name="question" placeholder="Enter your question here" />
          </div>
        </form>

    </div>
  </div>

</div>

<script>


    document.getElementById("questionInput").addEventListener("keypress", function(ev) {
      if (ev.key == "Enter") {
        submitHandle(ev);
      }
    });

    function submitHandle(ev) {
      console.debug("submit");
      ev.preventDefault();

      //change chat box
      let questionInput = document.getElementById("questionInput");
      let question = questionInput.value;
      questionInput.value = "";
      
      let chatBox = document.getElementById("chatBox");
      chatBox.innerHTML = chatBox.innerHTML + packQuestion(question);

      let askUrl = "/learn/ask";
      let options = {
        method: "POST",
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({question: question})
      };
      fetch(askUrl, options)
        .then(resp => resp.json())
        .then(data => {
          console.debug(data);
          chatBox.innerHTML = chatBox.innerHTML + packAnswer(data.answer);
        });
    }

    function packQuestion(question) {
      let html = [
        "<div class='text-end'>",
        "  <strong>Ask: </strong>" + question,
        "</div>"
      ].join("");

      return html;
    }

    function packAnswer(answer) {
      let html = [
        "<div class='text-start'>",
        "  <strong>Answer: </strong>" + answer,
        "</div>"
      ].join("");

      return html;

    }

</script>
{% endblock %}
