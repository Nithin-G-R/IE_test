{% extends 'base.html' %}


{% block title %}Learn Now{% endblock %}
                  

{% block nav %}
                  <li class="nav-item">
                    <a class="nav-link w3-bar-item w3-button" href="/">Home</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active w3-bar-item w3-button" href="/learn" aria-current="page">Learn Now</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link w3-bar-item w3-button" href="/play">Play Now</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link w3-bar-item w3-button" href="/Information">Information</a>
                  </li>
{% endblock %}



{% block body %}

    <br>
    <br>

<header class="bgimg2 w3-display-container w3-grayscale-min">
  <div class="w3-display-left w3-left" style = "align-items: center; padding-left: 5%">
      <p class="name fw-bolder" style="font-size:50px;color: #ffffff;">Easy PDF Reader</p>
      <p class="fw-bolder">Feel challenging on screen reading? Upload your pdf file and start your reading journey.</p>
  </div>
</header>

    <div class="w3-display-top" id="PDF_submit_box" style="max-width:500px; max-height: 400px">
        <p style="margin-left: -600px; font-size: 24px; font-weight: bold">Upload a PDF file here</p>
        <form action = "/learn/" method = "POST" enctype = "multipart/form-data" style="margin-left: -300px; margin-top: -40px">
            <input class="w3-light-grey w3-xlarge" type = "file" name = "file" /><input  style="margin-left: 0px; margin-top: 20px"  type = "submit" class = "learn_black_btn" value="Submit"/>
        </form>
    </div>
    <br>
    <div id="my_pdf_viewer" class="w3-center" style="width: 90%; display: block; margin: 0 auto;">
        <div id="navigation_controls" class="w3-center" style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
            <button id="zoom_in" style="font-weight: bold; width: 15%">+</button>
            <button accesskey="" id="go_previous" style="font-weight: bold; width: 15%">Previous</button>
            <input id="current_page" style="font-weight: bold; width: 40%; padding: 6px;" value="1" type="number"/>
            <button id="go_next"style="font-weight: bold; width: 15%">Next</button>
            <button id="zoom_out" style="font-weight: bold; width: 15%">-</button>
        </div>
        <br>
        <div id="canvas_container" class="w3-center" style="width: 100%; margin: 0 auto">
            <canvas id="pdf_renderer"></canvas>
        </div>
        <br>
    </div>
    
    <div class="w3-display-bottomright" style = "background-color: white; margin-bottom: 2%; margin-right: 2%; position: fixed">
        <button class="home_black_btn" onclick="window.location.href='/learn/chat';" style="padding: 10px 32px; text-align: center;"><b>Q&A Assistance</b></button>

<!--        <button class="btn" style=" padding: 10px 32px; text-align: center;font-size: 20px;"><a href="/play"><i class="fa fa-gamepad"></i> Relax now</a></button>-->
    </div>

    <script>
        var myState = {
            pdf: null,
            currentPage: 1,
            zoom: 1
        };

        var pdf = encodeURIComponent("{{ session.pdf }}");
        var url = "/static/" + pdf;
        console.debug(url);

        pdfjsLib.getDocument(url).promise.then(function(pdf) {
            myState.pdf = pdf;
            render();
            });
            function render() {
            myState.pdf.getPage(myState.currentPage).then(function(page) {
                var canvas = document.getElementById("pdf_renderer");
                var ctx = canvas.getContext('2d');

                var viewport = page.getViewport({scale: myState.zoom});
                canvas.width = viewport.width;
                canvas.height = viewport.height;

                  var renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                  };
                  page.render(renderContext).promise.then(function() {
                    // Display the PDF page
                    document.querySelector('#canvas_container').appendChild(canvas);
                  });

                });
            }

        const previous = document.getElementById("go_previous");
        const next = document.getElementById("go_next");

          function myPrevious() {
            if (myState.pdf == null || myState.currentPage == 1)
              return;
            myState.currentPage -= 1;
            document.getElementById("current_page").value = myState.currentPage;
            render();
          }

          previous.addEventListener("click", myPrevious);
          document.addEventListener("keydown", function(event) {
            if (event.code === "ArrowLeft") {
              previous.dispatchEvent(new Event("click"));
            }
          });

          function myNext() {
            if(myState.pdf == null || myState.currentPage > myState.pdf._pdfInfo.numPages)
               return;
            myState.currentPage += 1;
            document.getElementById("current_page").value = myState.currentPage;
            render();
          }

          next.addEventListener("click", myNext);
          document.addEventListener("keydown", function(event) {
            if (event.code === "ArrowRight") {
              next.dispatchEvent(new Event("click"));
            }
          });

<!--        document.getElementById('go_previous').addEventListener('click', function(e){-->
<!--            if (myState.pdf == null || myState.currentPage == 1)-->
<!--              return;-->
<!--            myState.currentPage -= 1;-->
<!--            document.getElementById("current_page").value = myState.currentPage;-->
<!--            render();-->
<!--        });-->

<!--        document.getElementById('go_next').addEventListener('click', function(e){-->
<!--            if(myState.pdf == null || myState.currentPage > myState.pdf._pdfInfo.numPages)-->
<!--               return;-->
<!--            myState.currentPage += 1;-->
<!--            document.getElementById("current_page").value = myState.currentPage;-->
<!--            render();-->
<!--        });-->

        document.getElementById('current_page').addEventListener('keypress', function(e) {
            if(myState.pdf == null) return;

            // Get key code
            var code = (e.keyCode ? e.keyCode : e.which);

            // If key code matches that of the Enter key
            if(code == 13) {
                var desiredPage =
                document.getElementById('current_page').valueAsNumber;

                if(desiredPage >= 1 && desiredPage <= myState.pdf._pdfInfo.numPages) {
                    myState.currentPage = desiredPage;
                    document.getElementById("current_page").value = desiredPage;
                    render();
                }
            }
        });

        document.getElementById('zoom_in').addEventListener('click', function(e){
            if(myState.pdf == null) return;
            myState.zoom += 0.5;
            render();
        });
        document.getElementById('zoom_out').addEventListener('click', function(e){
            if(myState.pdf == null) return;
            myState.zoom -= 0.5;
            render();
        });

        const myCanvas = document.getElementById("canvas_container");

          document.addEventListener("keydown", function(event) {
            if (event.code === "ArrowUp") {
              myCanvas.scrollTop -= 10;
            } else if (event.code === "ArrowDown") {
              myCanvas.scrollTop += 10;
            }
          });


    </script>
{% endblock %}
